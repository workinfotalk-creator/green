<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<title>Checkout - Green Cart Shop</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<!-- üé® Theme File Link -->
<link rel="stylesheet" href="theme.css">
<style>
input, textarea {
 width: 100%;
 padding: 12px;
 margin-bottom: 12px;
 font-size: 16px;
 box-sizing: border-box;
 border: 1px solid var(--border-color);
 border-radius: 10px;
 background: var(--card);
 color: var(--text-primary);
}
textarea {
 min-height: 70px;
 resize: vertical;
}
.note {
 font-size: 13px;
 color: var(--text-secondary);
 margin-bottom: 10px;
 padding: 10px;
 background: var(--card);
 border-radius: 8px;
 border: 1px solid var(--border-color);
}
h2 {
 text-align: center;
 color: var(--text-primary);
}
</style>
</head>
<body>
<div class="container">
<h2>üßæ Checkout</h2>
<div class="note">
‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶π‡¶ö‡ßç‡¶õ‡ßá‡•§ ‡¶ö‡¶æ‡¶á‡¶≤‡ßá ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßá ‡¶®‡¶§‡ßÅ‡¶® ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§
</div>
<input id="name" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ">
<input id="phone" placeholder="‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞">
<textarea id="address" placeholder="‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ"></textarea>
<button onclick="placeOrder()">‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
</div>
<script>
const API_URL = "https://script.google.com/macros/s/AKfycbwYWxzbimyMl1HwkTHl9YgtCWVHgseBngdcV2ZI5JCEfO8Xb-KoYSIa9CPa8R24-3y0/exec";

// üõí cart
let cart = JSON.parse(localStorage.getItem("cart")) || [];

// üë§ auto fill
let customer = JSON.parse(localStorage.getItem("customer")) || {};
document.getElementById("name").value = customer.name || "";
document.getElementById("phone").value = customer.phone || "";
document.getElementById("address").value = customer.address || "";

// üÜî Generate Order ID (‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶ú‡ßá‡¶®‡¶æ‡¶∞‡ßá‡¶ü)
function generateOrderId() {
  const date = new Date();
  const year = date.getFullYear().toString().slice(-2);
  const month = String(date.getMonth() + 1).padStart(2, '0');
  const day = String(date.getDate()).padStart(2, '0');
  const hours = String(date.getHours()).padStart(2, '0');
  const minutes = String(date.getMinutes()).padStart(2, '0');
  const seconds = String(date.getSeconds()).padStart(2, '0');
  const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
  
  // Format: GC-YYMMDD-HHMMSS-XXX
  return `GC-${year}${month}${day}-${hours}${minutes}${seconds}-${random}`;
}

function placeOrder(){
 if(cart.length === 0){
  alert("‡¶ï‡¶æ‡¶∞‡ßç‡¶ü ‡¶ñ‡¶æ‡¶≤‡¶ø");
  location.href="index.html";
  return;
 }
 
 const customerName = document.getElementById("name").value.trim();
 const customerPhone = document.getElementById("phone").value.trim();
 const customerAddress = document.getElementById("address").value.trim();
 
 if(!customerName || !customerPhone || !customerAddress){
  alert("‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®");
  return;
 }
 
 // ‚úÖ product names only
 const items = cart.map(p=>{
   return p.qty>1 ? `${p.name_bn} (${p.qty})` : p.name_bn;
 }).join(", ");
 
 // üÜî Generate unique order ID
 const orderId = generateOrderId();
 
 const orderData = {
  order_id: orderId,
  name: customerName,
  phone: customerPhone,
  address: customerAddress,
  items: items,
  date: new Date().toLocaleString("bn-BD")
 };
 
 // üíæ save for next auto fill
 localStorage.setItem("customer", JSON.stringify({
  name: customerName,
  phone: customerPhone,
  address: customerAddress
 }));
 
 // üöÄ SEND (CORS FIX)
 fetch(API_URL,{
  method:"POST",
  mode:"no-cors",
  headers: {
   "Content-Type": "application/json"
  },
  body: JSON.stringify(orderData)
 })
 .then(() => {
  // ‡¶™‡¶™‡¶Ü‡¶™ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶ì (‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶∏‡¶π)
  alert(`‚úÖ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!\n\n‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø: ${orderId}`);
  
  // ‡¶ï‡¶æ‡¶∞‡ßç‡¶ü ‡¶ñ‡¶æ‡¶≤‡¶ø ‡¶ï‡¶∞‡ßã
  localStorage.removeItem("cart");
  
  // ‡¶π‡ßã‡¶Æ ‡¶™‡ßá‡¶á‡¶ú‡ßá ‡¶´‡ßá‡¶∞‡¶§ ‡¶Ø‡¶æ‡¶ì
  location.href = "index.html";
 })
 .catch(err => {
  console.error("Error:", err);
  alert(`‚úÖ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!\n\n‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø: ${orderId}`);
  localStorage.removeItem("cart");
  location.href = "index.html";
 });
}
</script>
</body>
</html>
